        -:    0:Source:randomtestcard1.c
        -:    0:Graph:randomtestcard1.gcno
        -:    0:Data:randomtestcard1.gcda
        -:    0:Runs:1
        -:    0:Programs:1
        -:    1:/* -----------------------------------------------------------------------
        -:    2: * Random test for Smithy Card.
        -:    3: *
        -:    4: * randomtestcard1: randomtestcard1.c dominion.o rngs.o
        -:    5: *      gcc -o randomtestcard1 randomtestcard1.c -g dominion.o rngs.o $(CFLAGS)
        -:    6: * -----------------------------------------------------------------------
        -:    7: */
        -:    8:
        -:    9:#include "dominion.h"
        -:   10:#include "dominion_helpers.h"
        -:   11:#include <string.h>
        -:   12:#include <stdio.h>
        -:   13:#include <assert.h>
        -:   14:#include "rngs.h"
        -:   15:#include <stdlib.h>
        -:   16:#include <math.h>
        -:   17:#include <time.h>
        -:   18:
        -:   19:#define TESTCARD "smithy"
        -:   20:
function main called 1 returned 100% blocks executed 89%
        -:   21:int main()
        -:   22:{
        1:   23:    printf("\n----------------- Random Testing Card: %s ----------------\n", TESTCARD);
        1:   24:    int validator = 1;
        -:   25:    struct gameState G, testG;
        -:   26:    //int k[10] = {adventurer, gardens, embargo, village, minion, mine, cutpurse, sea_hag, tribute, smithy};
        -:   27:
        1:   28:    int numTests = 1000;
        -:   29:    int i, n, r;
        1:   30:    int choice1 = 0, choice2 = 0, choice3 = 0, bonus = 0;
        1:   31:    int handPos = 0;
        -:   32:    int currentPlayer;
        1:   33:    int addedCards = 3;
        1:   34:    int discard = 1;
        -:   35:    int totalCards, copytotalCards;
        1:   36:    int deckFailure = 0;
        1:   37:    int handFailure = 0;
        1:   38:    int discardFailure = 0;
        1:   39:    int testPassed = 0;
        -:   40:
        -:   41:    //initialize game state
        -:   42:    //initializeGame(numbPlayers, k, randSeed, &G);
        -:   43:
        -:   44:    // initialize random number
        1:   45:    srand(time(NULL));
        -:   46:
        -:   47:    // randomize hand size
     2002:   48:    for (i = 0; i < numTests; i++)
branch  0 taken 1000
branch  1 taken 1
        -:   49:    {
 13152000:   50:        for (n = 0; n < sizeof(struct gameState) / sizeof(int); n++)
branch  0 taken 6575000
branch  1 taken 1000
        -:   51:        {
  6575000:   52:            ((int *)&G)[n] = rand() % 128;
  6575000:   53:        }
        -:   54:        // generate random number of player from 2 to 4
     1000:   55:        G.numPlayers = (rand() % 3) + 2;
     1000:   56:        G.whoseTurn = rand() % G.numPlayers;
     1000:   57:        currentPlayer = whoseTurn(&G);
     1000:   58:        G.handCount[currentPlayer] = (rand() % (MAX_HAND / 2)) + 1;
        -:   59:
     1000:   60:        G.deckCount[currentPlayer] = (rand() % (MAX_DECK / 2)) + 1;
     1000:   61:        G.discardCount[currentPlayer] = (rand() % (MAX_DECK / 2)) + 1;
     1000:   62:        handPos = (rand() % G.handCount[currentPlayer]);
        -:   63:        // copy the game state to a test case
     1000:   64:        memcpy(&testG, &G, sizeof(struct gameState));
        -:   65:
        -:   66:        // play Smithy
     1000:   67:        r = cardEffect(smithy, choice1, choice2, choice3, &testG, handPos, &bonus);
     1000:   68:        if (r != 0)
branch  0 taken 0
branch  1 taken 1000
        -:   69:        {
    #####:   70:            validator = 0;
    #####:   71:            printf("FAIL when initializing playing %s card.\n", TESTCARD);
    #####:   72:        }
     1000:   73:        if (testG.handCount[currentPlayer] != G.handCount[currentPlayer] + addedCards - discard)
branch  0 taken 1000
branch  1 taken 0
        -:   74:        {
     1000:   75:            printf("Test FAILED - incorrect number of cards drawn!\n");
     1000:   76:            handFailure++;
     1000:   77:            validator = 0;
     1000:   78:        }
        -:   79:
     1000:   80:        totalCards = G.deckCount[currentPlayer] + G.discardCount[currentPlayer];
     1000:   81:        copytotalCards = testG.deckCount[currentPlayer] + testG.discardCount[currentPlayer];
     1000:   82:        if (copytotalCards != totalCards - addedCards)
branch  0 taken 1000
branch  1 taken 0
        -:   83:        {
     1000:   84:            printf("Test Failed - incorrect number of cards removed!\n");
     1000:   85:            deckFailure++;
     1000:   86:            validator = 0;
     1000:   87:        };
        -:   88:
     1000:   89:        if (validator)
branch  0 taken 0
branch  1 taken 1000
        -:   90:        {
    #####:   91:            printf("\n\n");
    #####:   92:            printf("*****************************************\n");
    #####:   93:            printf("*** All tests passed for %s card! ***\n", TESTCARD);
    #####:   94:            printf("*****************************************\n");
    #####:   95:            printf("\n\n");
    #####:   96:        }
        -:   97:        else
        -:   98:        {
     1000:   99:            printf("\n\n");
     1000:  100:            printf("************************************\n");
     1000:  101:            printf("*** There is BUG in %s card! ***\n", TESTCARD);
     1000:  102:            printf("************************************\n");
     1000:  103:            printf("\n\n");
        -:  104:        }
     1000:  105:    }
        -:  106:
        -:  107:
        1:  108:    printf("Number of Tests Passed: %d\n", testPassed);
        1:  109:    printf("Number of Cards Drawn To Hand Failed: %d\n", handFailure);
        1:  110:    printf("Number of Smithy Discarded Fails: %d\n\n", discardFailure);
        -:  111:
        1:  112:    return 0;
        -:  113:};
